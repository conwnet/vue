# 为了阅读 Vue 的源码

## 准备按照原项目的 commit 历史一点一点自己写试试

### 这一定是一场持久战

### 12月12日

在看第一个巨大的 commit，按照原来的样子画了个 build.js，但是由于 rollup 版本太老了，已经跑不起来了，以后慢慢改。然后从入口文件开始看，先对 src/instance/index.js 动手，很多问题留在代码文件中，后面看懂了再回来改。

#### 12月16日

看了 src/util/lang.js，主要是框架会用到的一些小函数，看了一遍具体实现。

这里发现了之前的一个理解误区，之前一直以为节流就是防抖，并且还不知道真正的防抖是啥意思。

### 12月17日

看了 observe 目录下的 array.js、batcher.js 和 dep.js，只是简单了解了每个文件的功能。

1. array.js 监控可以使数组发生变动的函数，在变动时做出通知。
2. batcher.js 实现了两个队列，用来处理 watcher，具体待定。
3. dep.js 实现了一个发布订阅，具体也得待定。

### 12月20日

这几天比较忙，用晚上的时间反反复复看了 index.js，这个文件应该就是对数据进行处理，比如要应用到 Vue 实例的 $data 上，然后让它在变化的时候触发通知。判断方法是，如果一个对象上有 __ob__ 属性，那这个属性就是可响应的了。

对于数组，就是利用之前看的 observer/array.js 中的东西。如果浏览器支持 __proto__ 属性，那就直接修改数组对象的原型为 observer/array.js 中已经修改过的可响应的 arrayMethods。如果不支持，那就把这个数组对象中每个可修改自身的方法（就是之前修改的 arrayMethods 中的属性），都重新设置一遍。最后对于数组中的每个元素都执行一遍监控。

对于普通的对象，直接对它的所有可枚举属性执行监控操作。

还有很多的小细节不懂，比如这里用到了 observe/dep.js 里面的东西，但是不知道用来干啥了。还有比如 Observer 对象原型中的 vms 又是干啥的呢。

### 1月1日

看了 compiler/html-parser.js 里面发现引用了一个 html-parser，主要用于把 html 字符串转成 AST。
